{% extends "base.html" %}
{% block title %}Report – CETRA{% endblock %}

{% block content %}
<h1>Extension Report</h1>

<div class="card report-card">

  <!-- HEADER -->
  <div class="report-header">
    <div>
      <h2 class="report-title">{{ report.file_hash }}</h2>
      <p class="mono">Extension ID: {{ report.extention_id }}</p>
    </div>

    <div class="report-score">
      <div class="score-circle">
        <span class="score-value">{{ report.score }}</span>
      </div>
      <div class="verdict {{ report.verdict|lower }}">
        {{ report.verdict }}
      </div>
    </div>
  </div>

  <hr>

  <!-- SUMMARY -->
  <div class="report-section">
    <h3>Summary</h3>
    <p>{{ report.summary|default:"No summary provided." }}</p>
  </div>

  <!-- BEHAVIOUR -->
  <div class="report-section">
    <h3>Behaviour</h3>
    <p>{{ report.behaviour|default:"Unavailable" }}</p>
  </div>

  <hr>

  <!-- PERMISSIONS -->
  <div class="report-section">
    <h3>Permissions</h3>
    {% if permissions %}
      <div class="badge-container">
        {% for p in permissions %}
          <span class="badge-permission">{{ p }}</span>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No permissions found.</p>
    {% endif %}
  </div>

  <hr>

  <!-- FINDINGS -->
  <div class="report-section">
    <h3>Findings</h3>

    {% if findings %}
      <table class="table clean-table">
        <thead>
          <tr>
            <th>Source</th>
            <th>Tag</th>
            <th>Category</th>
            <th>Type</th>
            <th>Family</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody>
          {% for f in findings %}
            <tr>
              <td>{{ f.api }}</td>
              <td>{{ f.tag }}</td>
              <td>{{ f.category }}</td>
              <td>{{ f.type }}</td>
              <td>{{ f.family|default:"—" }}</td>
              <td>{{ f.score }}</td> <!-- now plain value -->
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No findings available.</p>
    {% endif %}
  </div>

  <!-- BACK BUTTON INSIDE THE CARD -->
  <div class="report-footer">
    <a href="/history/" class="btn-pill btn-accent back-button">Back</a>
  </div>

</div>
{% endblock %}
