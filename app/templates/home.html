{% extends "base.html" %}
{% block title %}Home – CETRA{% endblock %}

{% block content %}
<h1>Home</h1>

<div class="card home-card">
  <p>Welcome to CETRA — analyze a Chrome extension by uploading a file or entering an ID.</p>

  <div class="submit-section">
    <h2>Submit an Extension</h2>
    <form action="{% url 'home' %}" method="post" enctype="multipart/form-data" class="submit-form">
      {% csrf_token %}
      <div class="submit-row">

        <!-- dropdown med ID som standard -->
        <select name="submit_type" class="select-input" required>
          <option value="id" selected>Extension ID</option>
          <option value="zip">ZIP File</option>
          <option value="crx">CRX File</option>
        </select>

        <!-- textfält + filfält (växlar med JS) -->
        <input type="text" name="submission_value" placeholder="Enter Chrome Web Store ID" required>
        <input type="file" name="submission_file" accept=".zip,.crx" class="file-input">

        <button type="submit" class="btn-pill btn-accent">Submit</button>
      </div>
    </form>

    {% if uploaded_file_url %}
      <p class="success">
        File uploaded successfully:
        <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a>
      </p>
    {% endif %}

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}
  </div>
</div>

<script>
  const select = document.querySelector('.select-input');
  const textField = document.querySelector('input[name="submission_value"]');
  const fileField = document.querySelector('input[name="submission_file"]');

  function toggleInputs() {
    if (select.value === 'id') {
      textField.style.display = 'block';
      fileField.style.display = 'none';
      textField.required = true;
      fileField.required = false;
    } else {
      textField.style.display = 'none';
      fileField.style.display = 'block';
      textField.required = false;
      fileField.required = true;
    }
  }

  toggleInputs();
  select.addEventListener('change', toggleInputs);
</script>
{% endblock %}
